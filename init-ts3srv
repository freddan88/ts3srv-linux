#!/bin/sh
# chkconfig: 2345 40 80
# description: Teamspeak Server
###############################
#
# Config:
DIR=/srv/ts3
EXE=ts3server_startscript.sh
USER=ts3
#
# Do not edit!
##############
case "$1" in

start)
	if [ -f $DIR/ts3server.ini ]; then
	license=$(cat $DIR/ts3server.ini | grep license_accepted)
		if [ "$license" == "license_accepted=1" ]; then
			su $USER -c ''$DIR/$EXE' start inifile=ts3server.ini'
		else
			echo "###"
			echo "#"
			echo "# Please Read and Accept the License"
			echo "# Read Teamspeak License in $DIR/LICENSE"
			echo "# Change license_accepted in $DIR/ts3server.ini"
			echo "#"
			echo "###"
		fi
	fi

	if ! [ -f $DIR/ts3server.ini ]; then
		rm -f $DIR/ts3server.pid 2>/dev/null
		su $USER -c ''$DIR/$EXE' 2>/dev/null start createinifile=1' 1>/dev/null
		echo "###"
		echo "#"
		echo "# Creating config in $DIR/ts3server.ini"
		echo "#"
		echo "###"
		rm -f $DIR/ts3server.pid 2>/dev/null
	fi
;;

stop)
	su $USER -c ''$DIR/$EXE' stop'
;;

restart)
	su $USER -c ''$DIR/$EXE' restart inifile=ts3server.ini'
;;

status)
echo " "
	su $USER -c ''$DIR/$EXE' status'
	if [ -f $DIR/ts3server.pid ]; then
	alive=$(ps -e | grep $(cat $DIR/ts3server.pid) | cut --delimiter=" " --fields=12)
	echo "$alive is running as pid: $(pgrep -a --pidfile $DIR/ts3server.pid | cut --delimiter=" " --fields=1)"
	fi
echo " "
;;

*)
	echo "Usage: {start|stop|restart|status}"
;;

esac
exit